@{
    ViewData["Title"] = "Raffle";
    Layout = "_Layout";
}

<div class="raffle-roller">
    <div class="raffle-roller-holder">
        <div class="raffle-roller-container"></div>
    </div>
</div>

<center>
    <span style="font-size: 25px;">You winning is <span style="color: green;" id="rolled">rolling</span></span>
    <br>
    <button id="goBtn">go</button>
    <button onclick="window.location.reload();">reset</button>
</center>

<br>
<div class="inventory"></div>

@section Scripts {
        <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
        <script>
            let items = [];

            $(async function () {
                // Завантажуємо предмети із сервера
                const response = await fetch('/Raffle/GetItems');
                items = await response.json();
            });

            $('#goBtn').click(async function () {
                const res = await fetch('/Raffle/Roll', { method: 'POST' });
                const win = await res.json();

                generate(win);
            });

            function generate(win) {
                $('.raffle-roller-container').html('').css({
                    transition: "none",
                    "margin-left": "0px"
                });

                // 100 випадкових предметів
                for (let i = 0; i < 101; i++) {
                    const item = getRandomItem();
                    const element = `<div class="item class_red_item" style="background-image:url(${item.imageUrl});"></div>`;
                    $('.raffle-roller-container').append(element);
                }

                // 78-ма картка — виграш
                $('#CardNumber78').css({
                    "background-image": "url(" + win.imageUrl + ")"
                });

                setTimeout(() => goRoll(win), 500);
            }

            function goRoll(win) {
                $('.raffle-roller-container').css({
                    transition: "all 8s cubic-bezier(.08,.6,0,1)"
                });

                setTimeout(() => {
                    $('#CardNumber78').addClass('winning-item');
                    $('#rolled').html(win.skin);
                    const winElement = `<div class='item class_red_item' style='background-image: url(${win.imageUrl})'></div>`;
                    $('.inventory').append(winElement);
                }, 8500);

                $('.raffle-roller-container').css('margin-left', '-6770px');
            }

            function getRandomItem() {
                const i = Math.floor(Math.random() * items.length);
                return items[i];
            }
        </script>
}

@section Styles {
        <link href="https://fonts.googleapis.com/css?family=Arvo" rel="stylesheet">
        <style>
            body { background: rgb(25,25,33); }
            .raffle-roller {
                height: 100px;
                position: relative;
                margin: 60px auto 30px auto;
                width: 900px;
            }
            .raffle-roller-holder {
                position: absolute;
                top: 0; left: 0; right: 0; bottom: 0;
                height: 100px; width: 100%;
                overflow: hidden;
                border-radius: 2px;
                border: 1px solid #3c3759;
            }
            .raffle-roller-container {
                width: 999999999999px;
                height: 100px;
                background: #191726;
                margin-left: 0;
                transition: all 8s cubic-bezier(.08,.6,0,1);
            }
            .raffle-roller-holder:before {
                content: "";
                position: absolute;
                z-index: 12222225;
                width: 5px;
                height: 100%;
                left: 50%;
                background: #d16266;
            }
            .item {
                display: inline-block;
                margin: 4px 0px 0.5px 5px;
                width: 85px;
                height: 88px;
                border: 1px solid #70677c;
                background: #14202b;
                background-size: 100%;
                background-repeat: no-repeat;
                background-position: center;
            }
            .class_red_item { border-bottom: 4px solid #EB4B4B; }
            .winning-item {
                border: 2px solid #66b233;
                top: -1px;
                border-bottom: 4px solid #66b233;
            }
            .inventory {
                margin: 0 auto;
                width: 960px;
                padding: 10px 15px 6px;
                border: 2px solid #1c3344;
                background: #0e1a23;
            }
            .inventory > .item {
                float: none;
                cursor: pointer;
                margin: 4px 2px 0.5px 2px;
            }
            .inventory > .item:hover {
                background-size: 90%;
                background-color: #182a38;
            }
        </style>
}
