@model Gymify.Application.ViewModels.Case.CaseViewModel

@{
    ViewData["Title"] = "Case";
}

<!--> це базові дані типу ім'я картинка кейса перед відкриттям, кнопка'</!-->

<h2 class="text-center">@Model.CaseInfo.CaseName</h2>

<form asp-action="OpenCase" method="post">
    <div class="text-center">
        <button id="openCaseBtn" class="btn btn-primary">
            Відкрити кейс
        </button>
    </div>
</form>

<div class="roulette-container">
    <div id="roulette-strip"></div>
</div>
<!--> це базові дані типу ім'я картинка кейса перед відкриттям'</!-->

<!--> це типу вспливаюче вікно</!-->
<div id="resultModal" class="modal hidden">
    <div class="modal-content">
        <h2>Твій дроп!</h2>
        <img id="dropImage" src="" width="150" />
        <h3 id="dropName"></h3>
        <p id="dropRarity"></p>
        <button id="closeModal">Закрити</button>
    </div>
</div>
<!--> це типу вспливаюче вікно</!-->

@section Scripts {
    <script>
        document.getElementById("openCaseBtn").addEventListener("click", async (e) => {
            const caseId = e.target.dataset.caseId;
            const response = await fetch(`/Case/Open?caseId=${caseId}`, { method: "POST" });
            if (!response.ok) { alert("Помилка при відкритті кейсу!"); return; }

            const data = await response.json();
            const strip = document.getElementById("roulette-strip");
            strip.innerHTML = '';

            // додаємо айтеми у рулетку
            data.rewards.forEach(item => {
                const div = document.createElement('div');
                div.classList.add('item');
                div.innerHTML = `<img src="${item.imageURL}" width="100" height="100" /><p>${item.name}</p>`;
                strip.appendChild(div);
            });

            // анімація рулетки
            const itemWidth = 130;
            const offset = data.selectedIndex * itemWidth - 400; // центрування виграшу
            strip.style.transition = 'transform 4s cubic-bezier(0.25,1,0.5,1)';
            strip.style.transform = `translateX(-${offset}px)`;

            setTimeout(() => {
                document.getElementById("dropImage").src = data.dropItemImageURL;
                document.getElementById("dropName").textContent = data.dropItemName;
                document.getElementById("dropRarity").textContent = data.dropItemRarity;
                document.getElementById("resultModal").classList.remove("hidden");
            }, 4200);
        });

        document.getElementById("closeModal").addEventListener("click", () => {
            document.getElementById("resultModal").classList.add("hidden");
        });
    </script>
}